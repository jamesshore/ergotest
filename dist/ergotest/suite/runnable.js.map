{"version":3,"sources":["/Users/jshore/Documents/Projects/ergotest/src/ergotest/suite/runnable.ts"],"sourcesContent":["// Copyright Titanium I.T. LLC. License granted under terms of \"The MIT License.\"\nimport { Milliseconds, RunOptions } from \"./test.js\";\nimport { RunResult, TestMark } from \"../results/test_result.js\";\nimport { ItFn, ItOptions } from \"../test_api.js\";\nimport { RunData } from \"./test_suite.js\";\n\nexport class Runnable {\n\n\tprivate readonly _name: string[];\n\tprivate readonly _options: ItOptions;\n\tprivate readonly _fnAsync?: ItFn;\n\n\tconstructor(name: string[], options: ItOptions, fnAsync: ItFn | undefined) {\n\t\tthis._name = name;\n\t\tthis._options = options;\n\t\tthis._fnAsync = fnAsync;\n\t}\n\n\tget name(): string[] {\n\t\treturn this._name;\n\t}\n\n\tget options(): ItOptions {\n\t\treturn this._options;\n\t}\n\n\tget fnAsync(): ItFn | undefined {\n\t\treturn this._fnAsync;\n\t}\n\n\tasync _runTestFnAsync(\n\t\trunOptions: RunOptions,\n\t\trunData: RunData,\n\t): Promise<RunResult> {\n\t\tconst fnAsync = this._fnAsync;\n\t\tif (runData.skipAll || fnAsync === undefined) {\n\t\t\treturn RunResult.skip({\n\t\t\t\tname: this._name,\n\t\t\t\tfilename: runData.filename\n\t\t\t});\n\t\t}\n\n\t\tconst timeout = this._options.timeout ?? runData.timeout;\n\t\treturn await runOptions.clock.timeoutAsync(timeout, async () => {\n\t\t\ttry {\n\t\t\t\tawait fnAsync({ getConfig });\n\t\t\t\treturn RunResult.pass({\n\t\t\t\t\tname: this._name,\n\t\t\t\t\tfilename: runData.filename\n\t\t\t\t});\n\t\t\t}\n\t\t\tcatch (error) {\n\t\t\t\treturn RunResult.fail({\n\t\t\t\t\tname: this._name,\n\t\t\t\t\tfilename: runData.filename,\n\t\t\t\t\terror,\n\t\t\t\t\trenderError: runOptions.renderError\n\t\t\t\t});\n\t\t\t}\n\t\t}, async () => {\n\t\t\treturn await RunResult.timeout({\n\t\t\t\tname: this._name,\n\t\t\t\tfilename: runData.filename,\n\t\t\t\ttimeout: runData.timeout\n\t\t\t});\n\t\t});\n\n\t\tfunction getConfig<T>(name: string) {\n\t\t\tif (runOptions.config[name] === undefined) throw new Error(`No test config found for name '${name}'`);\n\t\t\treturn runOptions.config[name] as T;\n\t\t}\n\t}\n\n}\n\n"],"names":["RunResult","Runnable","_name","_options","_fnAsync","constructor","name","options","fnAsync","_runTestFnAsync","runOptions","runData","skipAll","undefined","skip","filename","timeout","clock","timeoutAsync","getConfig","pass","error","fail","renderError","config","Error"],"mappings":"AAAA,iFAAiF;AAEjF,SAASA,SAAS,QAAkB,4BAA4B;AAIhE,OAAO,MAAMC;IAEKC,MAAgB;IAChBC,SAAoB;IACpBC,SAAgB;IAEjCC,YAAYC,IAAc,EAAEC,OAAkB,EAAEC,OAAyB,CAAE;QAC1E,IAAI,CAACN,KAAK,GAAGI;QACb,IAAI,CAACH,QAAQ,GAAGI;QAChB,IAAI,CAACH,QAAQ,GAAGI;IACjB;IAEA,IAAIF,OAAiB;QACpB,OAAO,IAAI,CAACJ,KAAK;IAClB;IAEA,IAAIK,UAAqB;QACxB,OAAO,IAAI,CAACJ,QAAQ;IACrB;IAEA,IAAIK,UAA4B;QAC/B,OAAO,IAAI,CAACJ,QAAQ;IACrB;IAEA,MAAMK,gBACLC,UAAsB,EACtBC,OAAgB,EACK;QACrB,MAAMH,UAAU,IAAI,CAACJ,QAAQ;QAC7B,IAAIO,QAAQC,OAAO,IAAIJ,YAAYK,WAAW;YAC7C,OAAOb,UAAUc,IAAI,CAAC;gBACrBR,MAAM,IAAI,CAACJ,KAAK;gBAChBa,UAAUJ,QAAQI,QAAQ;YAC3B;QACD;QAEA,MAAMC,UAAU,IAAI,CAACb,QAAQ,CAACa,OAAO,IAAIL,QAAQK,OAAO;QACxD,OAAO,MAAMN,WAAWO,KAAK,CAACC,YAAY,CAACF,SAAS;YACnD,IAAI;gBACH,MAAMR,QAAQ;oBAAEW;gBAAU;gBAC1B,OAAOnB,UAAUoB,IAAI,CAAC;oBACrBd,MAAM,IAAI,CAACJ,KAAK;oBAChBa,UAAUJ,QAAQI,QAAQ;gBAC3B;YACD,EACA,OAAOM,OAAO;gBACb,OAAOrB,UAAUsB,IAAI,CAAC;oBACrBhB,MAAM,IAAI,CAACJ,KAAK;oBAChBa,UAAUJ,QAAQI,QAAQ;oBAC1BM;oBACAE,aAAab,WAAWa,WAAW;gBACpC;YACD;QACD,GAAG;YACF,OAAO,MAAMvB,UAAUgB,OAAO,CAAC;gBAC9BV,MAAM,IAAI,CAACJ,KAAK;gBAChBa,UAAUJ,QAAQI,QAAQ;gBAC1BC,SAASL,QAAQK,OAAO;YACzB;QACD;QAEA,SAASG,UAAab,IAAY;YACjC,IAAII,WAAWc,MAAM,CAAClB,KAAK,KAAKO,WAAW,MAAM,IAAIY,MAAM,CAAC,+BAA+B,EAAEnB,KAAK,CAAC,CAAC;YACpG,OAAOI,WAAWc,MAAM,CAAClB,KAAK;QAC/B;IACD;AAED"}