{"version":3,"sources":["/Users/jshore/Documents/Projects/ergotest/src/ergotest/assert.ts"],"sourcesContent":["// Copyright Titanium I.T. LLC. License granted under terms of \"The MIT License.\"\n\n// ****\n// An assertion library that works the way *I* want it to. <oldmanvoice>Get off my lawn!</oldmanvoice>\n// ****\n\n/* eslint @typescript-eslint/no-unsafe-function-type: \"off\" */\n// Several assertions operate on arbitrary functions.\n\nimport util from \"node:util\";\nimport { TypeDescriptor as TypeLibDescriptor, check as typeCheck, describe as describeType } from \"../util/type.js\";\nimport { AssertionError } from \"node:assert\";\n\ninterface DotEquals {\n\tequals(that: unknown): boolean,\n}\n\ninterface Includes {\n\tincludes(any: unknown): boolean,\n}\n\nexport type TypeDescriptor = TypeLibDescriptor;\n\nexport function fail(message: string, actual?: unknown, expected?: unknown): never {\n\tthrow new AssertionError({ message, actual, expected });\n}\n\nexport function todo(message?: string): never {\n\tmessage = message ? `: ${message}` : \"\";\n\tfail(`TO DO${message}`);\n}\n\nexport function identity(actual: unknown, expected: unknown, message?: string) {\n\tcheckExpected(expected);\n\tif (typeof expected !== \"object\" && typeof expected !== \"function\") {\n\t\tthrowAssertionError(message, \"'expected' is not an object\", actual, expected);\n\t}\n\tif (expected === null) throwAssertionError(message, \"'expected' is null\", actual, expected);\n\n\tif (actual !== expected) throwAssertionError(message, \"should have same object reference\", actual, expected);\n}\n\nexport function notIdentity(actual: unknown, expected: unknown, message?: string) {\n\tcheckExpected(expected);\n\tif (typeof expected !== \"object\") throwAssertionError(message, \"'expected' is not an object\", actual, expected);\n\tif (expected === null) throwAssertionError(message, \"'expected' is null\", actual, expected);\n\n\tif (actual === expected) throwAssertionError(message, \"should not have same object reference\", actual, expected);\n}\n\nexport function equal(actual: unknown, expected: unknown,  message?: string) {\n\tcheckExpected(expected);\n\tif (!util.isDeepStrictEqual(actual, expected)) {\n\t\tthrowAssertionError(message, \"should be equal\", actual, expected);\n\t}\n}\n\nexport function notEqual(actual: unknown, expected: unknown,  message?: string) {\n\tcheckExpected(expected);\n\tif (util.isDeepStrictEqual(actual, expected)) {\n\t\tthrowAssertionError(message, \"should not be equal\", actual, expected);\n\t}\n}\n\nexport function dotEquals(actual: unknown, expected: DotEquals,  message?: string) {\n\tcheckExpected(expected);\n\n\tmessage = message ? `${message}: ` : \"\";\n\tisDefined(actual, message);\n\tif (expected.equals === undefined) fail(message + \"'expected' does not have equals() method\");\n\tif (!expected.equals(actual)) throwAssertionError(message, \"should be .equals()\", actual, expected);\n}\n\nexport function notDotEquals(actual: unknown, expected: DotEquals,  message?: string) {\n\tcheckExpected(expected);\n\n\tmessage = message ? `${message}: ` : \"\";\n\tisDefined(actual, message);\n\tif (expected.equals === undefined) fail(message + \"'expected' does not have equals() method\");\n\tif (expected.equals(actual)) throwAssertionError(message, \"should not be equal()\", actual, expected);\n}\n\nexport function isDefined(actual: unknown, message?: string) {\n\tif (actual === undefined) throwAssertionError(message, \"should not be undefined\");\n}\n\nexport function isUndefined(actual: unknown, message?: string) {\n\tif (actual !== undefined) throwAssertionError(message, \"should be undefined\", actual);\n}\n\nexport function isTrue(actual: unknown, message?: string) {\n\tif (actual !== true) throwAssertionError(message, \"should be true\", actual, true);\n}\n\nexport function isFalse(actual: unknown, message?: string) {\n\tif (actual !== false) throwAssertionError(message, \"should be false\", actual, false);\n}\n\nexport function isNull(actual: unknown, message?: string) {\n\tif (actual !== null) throwAssertionError(message, \"should be null\", actual, null);\n}\n\nexport function isNotNull(actual: unknown, message?: string) {\n\tif (actual === null) throwAssertionError(message, \"should not be null\", actual);\n}\n\nexport function atLeast(actual: unknown, expected: unknown,  message?: string) {\n\tcheckExpected(expected);\n\tif ((actual as number) < (expected as number)) {\n\t\tthrowAssertionError(message, `should be at least ${expected}`, actual, expected);\n\t}\n}\n\nexport function atMost(actual: unknown, expected: unknown,  message?: string) {\n\tcheckExpected(expected);\n\tif ((actual as number) > (expected as number)) {\n\t\tthrowAssertionError(message, `should be at most ${expected}`, actual, expected);\n\t}\n}\n\nexport function between(actual: unknown, min: unknown, max: unknown, message?: string) {\n\tisDefined(actual, message);\n\tmessage = message ? `${message}: ` : \"\";\n\tif ((actual as number) < (min as number) || (actual as number) > (max as number)) {\n\t\tfail(message + \"should be between \" + min + \" and \" + max + \" (inclusive), but was \" + actual);\n\t}\n}\n\nexport function match(actual: string, expected: RegExp, message?: string) {\n\tcheckExpected(expected);\n\tif (typeof actual !== \"string\") throwAssertionError(message, `should have been string, but was ${typeof actual}`);\n\tif (!expected.test(actual)) throwAssertionError(message, \"should match regex\", actual, expected);\n}\n\nexport function matchesGroup(actual: string, regex: RegExp, expectedMatch: string | null, message?: string) {\n\tmessage = message ?? \"regex group\";\n\tconst regexResult = regex.exec(actual);\n\tconst actualMatch = regexResult === null ? null : regexResult[1];\n\n\tif (expectedMatch === null && actualMatch === null) {\n\t\treturn;\n\t}\n\telse if (expectedMatch === null && actualMatch !== null) {\n\t\tfail(`should not have found ${message}, but it was '${actualMatch}' (searched with ${regex})`);\n\t}\n\telse if (expectedMatch !== null && actualMatch === null) {\n\t\tfail(`${message} expected '${expectedMatch}', but nothing was found (searched with ${regex})`);\n\t}\n\telse {\n\t\tequal(actualMatch, expectedMatch, message);\n\t}\n}\n\nexport function includes(actual: Includes, expected: unknown,  message?: string) {\n\tcheckExpected(expected);\n\tisDefined(actual, message);\n\tif (!actual.includes(expected)) {\n\t\tthrowAssertionError(message, \"actual value should include expected value\", actual, expected);\n\t}\n}\n\nexport function notIncludes(actual: Includes, expected: unknown,  message?: string) {\n\tcheckExpected(expected);\n\tisDefined(actual, message);\n\tif (actual.includes(expected)) {\n\t\tthrowAssertionError(message, \"actual value should not include expected value\", actual, expected);\n\t}\n}\n\nexport function error(fn: Function, expected?: RegExp | string, message?: string) {\n\ttry {\n\t\tfn();\n\t}\n\tcatch (err) {\n\t\tif (expected === undefined) return;\n\t\tif (!(err instanceof Error)) fail(`should have thrown Error, but was: ${err}`);\n\t\tif (typeof expected === \"string\") {\n\t\t\tequal(err.message, expected, message);\n\t\t}\n\t\telse {\n\t\t\tmatch(err.message, expected, message);\n\t\t}\n\t\treturn;\n\t}\n\tthrowAssertionError(message, \"Expected exception\");\n}\n\nexport function notError(fn: Function) {\n\tfn();\n}\n\nexport async function errorAsync(fnAsync: Function, expectedRegexOrExactString?: RegExp | string, message?: string) {\n\ttry {\n\t\tawait fnAsync();\n\t}\n\tcatch (err) {\n\t\tif (expectedRegexOrExactString === undefined) return;\n\t\tif (!(err instanceof Error)) fail(`should have thrown Error, but was: ${err}`);\n\t\tif (typeof expectedRegexOrExactString === \"string\") {\n\t\t\tequal(err.message, expectedRegexOrExactString, message);\n\t\t}\n\t\telse {\n\t\t\tmatch(err.message, expectedRegexOrExactString, message);\n\t\t}\n\t\treturn;\n\t}\n\tthrowAssertionError(message, \"Expected exception\");\n}\n\nexport async function notErrorAsync(fnAsync: Function) {\n\tawait fnAsync();\n}\n\nexport function type(actual: unknown, expected: TypeDescriptor,  message?: string) {\n\tcheckExpected(expected);\n\tconst error = typeCheck(actual, expected);\n\tif (error !== null) {\n\t\tthrowAssertionError(message, \"type should match\", actual, describeType(expected));\n\t}\n}\n\nfunction checkExpected(expected: unknown) {\n\tif (expected === undefined) fail(\"'undefined' provided as expected value in assertion\");\n}\n\nfunction throwAssertionError(\n\tuserMessage: string | undefined,\n\tassertionMessage: string,\n\tactual?: unknown,\n\texpected?: unknown,\n): never {\n\tuserMessage = userMessage ? `${userMessage}: ` : \"\";\n\tthrow new AssertionError({ message: `${userMessage}${assertionMessage}`, actual, expected });\n}"],"names":["util","check","typeCheck","describe","describeType","AssertionError","fail","message","actual","expected","todo","identity","checkExpected","throwAssertionError","notIdentity","equal","isDeepStrictEqual","notEqual","dotEquals","isDefined","equals","undefined","notDotEquals","isUndefined","isTrue","isFalse","isNull","isNotNull","atLeast","atMost","between","min","max","match","test","matchesGroup","regex","expectedMatch","regexResult","exec","actualMatch","includes","notIncludes","error","fn","err","Error","notError","errorAsync","fnAsync","expectedRegexOrExactString","notErrorAsync","type","userMessage","assertionMessage"],"mappings":"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"}