{"version":3,"sources":["/Users/jshore/Documents/Projects/ergotest/src/tests/assert.ts"],"sourcesContent":["// Copyright Titanium I.T. LLC. License granted under terms of \"The MIT License.\"\n\n// ****\n// An assertion library that works the way *I* want it to. <oldmanvoice>Get off my lawn!</oldmanvoice>\n// ****\n\n/* eslint @typescript-eslint/no-unsafe-function-type: \"off\" */\n// Several assertions operate on arbitrary functions.\n\nimport util from \"node:util\";\nimport * as typeLib from \"../util/type.js\";\nimport { AssertionError } from \"node:assert\";\n\ninterface ObjEquals {\n\tequals(that: unknown): boolean,\n}\n\ninterface Includes {\n\tincludes(any: unknown): boolean,\n}\n\nexport function fail(message: string): never {\n\tthrow new AssertionError({ message });\n}\n\nexport function todo(message?: string): never {\n\tmessage = message ? `: ${message}` : \"\";\n\tfail(`TO DO${message}`);\n}\n\nexport function defined(actual: unknown, message?: string) {\n\tif (actual === undefined) throwAssertionError(message, \"expected value, but was undefined\");\n}\n\nexport function isUndefined(actual: unknown, message?: string) {\n\tif (actual !== undefined) throwAssertionError(message, \"expected value, but was undefined\", actual);\n}\n\nexport function isTrue(actual: unknown, message?: string) {\n\tif (actual !== true) throwAssertionError(message, \"expected true\", actual, true);\n}\n\nexport function isFalse(actual: unknown, message?: string) {\n\tif (actual !== false) throwAssertionError(message, \"expected false\", actual, false);\n}\n\nexport function isNull(actual: unknown, message?: string) {\n\tif (actual !== null) throwAssertionError(message, \"expected null\", actual, null);\n}\n\nexport function isNotNull(actual: unknown, message?: string) {\n\tif (actual === null) throwAssertionError(message, \"expected non-null\", actual);\n}\n\nexport function atLeast(actual: number, expected: number,  message?: string) {\n\tcheckExpected(expected);\n\tif (actual < expected) throwAssertionError(message, `expected at least ${expected}`, actual, expected);\n}\n\nexport function atMost(actual: number, expected: number,  message?: string) {\n\tcheckExpected(expected);\n\tif (actual > expected) throwAssertionError(message, `expected at most ${expected}`, actual, expected);\n}\n\nexport function equal(actual: unknown, expected: unknown,  message?: string) {\n\tcheckExpected(expected);\n\tif (expected !== actual) throwAssertionError(message, \"expected equality\", actual, expected);\n}\n\nexport function notEqual(actual: unknown, expected: unknown,  message?: string) {\n\tcheckExpected(expected);\n\tif (expected === actual) throwAssertionError(message, \"expected no equality\", actual, expected);\n}\n\nexport function deepEqual(actual: unknown, expected: unknown,  message?: string) {\n\tcheckExpected(expected);\n\tif (!util.isDeepStrictEqual(actual, expected)) {\n\t\tthrowAssertionError(message, \"expected deep equality\", actual, expected);\n\t}\n}\n\nexport function type(actual: unknown, expected: typeLib.TypeDescriptor,  message?: string) {\n\tcheckExpected(expected);\n\tconst error = typeLib.check(actual, expected);\n\tif (error !== null) {\n\t\tthrowAssertionError(message, \"type should match\", actual, typeLib.describe(expected));\n\t}\n}\n\nexport function objEqual(actual: unknown, expected: ObjEquals,  message?: string) {\n\tcheckExpected(expected);\n\n\tmessage = message ? `${message}: ` : \"\";\n\tdefined(actual, message);\n\tif (expected.equals === undefined) fail(message + \"'expected' does not have equals() method\");\n\tif (!expected.equals(actual)) throwAssertionError(message, \"should be equal()\", actual, expected);\n}\n\nexport function objNotEqual(actual: ObjEquals, expected: unknown,  message?: string) {\n\tcheckExpected(expected);\n\n\tmessage = message ? `${message}: ` : \"\";\n\tdefined(actual, message);\n\tif (actual.equals === undefined) fail(message + \"does not have equals() method\");\n\tisFalse(actual.equals(expected), message + \"expected '\" + expected + \"' and '\" + actual + \"' to be not be equal(), but they were\");\n}\n\nexport function between(value: number, min: number, max: number, message?: string) {\n\tdefined(value, message);\n\tmessage = message ? `${message}: ` : \"\";\n\tif (value < min || value > max) {\n\t\tfail(message + \"expected value between \" + min + \" and \" + max + \" (inclusive), but was \" + value);\n\t}\n}\n\nexport function match(actual: unknown, expectedRegex: RegExp, message?: string) {\n\tif (typeof actual !== \"string\") throwAssertionError(message, `should have been string, but was ${typeof actual}`);\n\tif (!expectedRegex.test(actual)) throwAssertionError(message, \"should match regex\", actual, expectedRegex);\n}\n\nexport function matchesGroup(actual: string, regex: RegExp, expectedMatch: string | null, message?: string | null) {\n\tmessage = message ?? \"regex group\";\n\tconst regexResult = regex.exec(actual);\n\tconst actualMatch = regexResult === null ? null : regexResult[1];\n\n\tif (expectedMatch === null && actualMatch === null) {\n\t\treturn;\n\t}\n\telse if (expectedMatch === null && actualMatch !== null) {\n\t\tfail(`should not have found ${message}, but it was '${actualMatch}' (searched with ${regex})`);\n\t}\n\telse if (expectedMatch !== null && actualMatch === null) {\n\t\tfail(`${message} expected '${expectedMatch}', but nothing was found (searched with ${regex})`);\n\t}\n\telse {\n\t\tequal(actualMatch, expectedMatch, message);\n\t}\n}\n\n\nexport function includes(actual: Includes, expected: unknown,  message?: string) {\n\tcheckExpected(expected);\n\tif (!actual.includes(expected)) {\n\t\tthrowAssertionError(message, \"actual value should include expected value\", actual, expected);\n\t}\n}\n\nexport function notIncludes(actual: Includes, expected: unknown,  message?: string) {\n\tcheckExpected(expected);\n\tif (actual.includes(expected)) {\n\t\tthrowAssertionError(message, \"actual value should not include expected value\", actual, expected);\n\t}\n}\n\nexport function noException(fn: Function) {\n\tfn();\n}\n\nexport function exception(fn: Function, expectedRegexOrExactString?: RegExp | string, message?: string) {\n\ttry {\n\t\tfn();\n\t}\n\tcatch (err) {\n\t\tif (expectedRegexOrExactString === undefined) return;\n\t\tif (!(err instanceof Error)) fail(`Should have thrown Error, but was: ${err}`);\n\t\tif (typeof expectedRegexOrExactString === \"string\") {\n\t\t\tequal(err.message, expectedRegexOrExactString, message);\n\t\t}\n\t\telse {\n\t\t\tmatch(err.message, expectedRegexOrExactString, message);\n\t\t}\n\t\treturn;\n\t}\n\tthrowAssertionError(message, \"Expected exception\");\n}\n\nexport async function exceptionAsync(fnAsync: Function, expectedRegexOrExactString?: RegExp | string, message?: string) {\n\ttry {\n\t\tawait fnAsync();\n\t}\n\tcatch (err) {\n\t\tif (expectedRegexOrExactString === undefined) return;\n\t\tif (!(err instanceof Error)) fail(`Should have thrown Error, but was: ${err}`);\n\t\tif (typeof expectedRegexOrExactString === \"string\") {\n\t\t\tequal(err.message, expectedRegexOrExactString, message);\n\t\t}\n\t\telse {\n\t\t\tmatch(err.message, expectedRegexOrExactString, message);\n\t\t}\n\t\treturn;\n\t}\n\tthrowAssertionError(message, \"Expected exception\");\n}\n\nexport async function noExceptionAsync(fnAsync: Function) {\n\tawait fnAsync();\n}\n\nfunction checkExpected(expected: unknown) {\n\tif (expected === undefined) fail(\"'undefined' provided as expected value in assertion\");\n}\n\nfunction throwAssertionError(\n\tuserMessage: string | undefined,\n\tassertionMessage: string,\n\tactual?: unknown,\n\texpected?: unknown,\n): never {\n\tuserMessage = userMessage ? `${userMessage}: ` : \"\";\n\tthrow new AssertionError({ message: `${userMessage}${assertionMessage}`, actual, expected });\n}"],"names":["util","typeLib","AssertionError","fail","message","todo","defined","actual","undefined","throwAssertionError","isUndefined","isTrue","isFalse","isNull","isNotNull","atLeast","expected","checkExpected","atMost","equal","notEqual","deepEqual","isDeepStrictEqual","type","error","check","describe","objEqual","equals","objNotEqual","between","value","min","max","match","expectedRegex","test","matchesGroup","regex","expectedMatch","regexResult","exec","actualMatch","includes","notIncludes","noException","fn","exception","expectedRegexOrExactString","err","Error","exceptionAsync","fnAsync","noExceptionAsync","userMessage","assertionMessage"],"mappings":"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"}