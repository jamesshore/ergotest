{"version":3,"sources":["/Users/jshore/Documents/Projects/ergotest/src/tests/test_renderer.ts"],"sourcesContent":["// Copyright Titanium I.T. LLC. License granted under terms of \"The MIT License.\"\n\nimport * as ensure from \"../util/ensure.js\";\nimport { TestCaseResult, TestMark, TestMarkValue, TestResult, TestStatus, TestSuiteResult } from \"./test_result.js\";\nimport { ColorFn, Colors } from \"../infrastructure/colors.js\";\nimport path from \"node:path\";\nimport { AssertionError } from \"node:assert\";\nimport util from \"node:util\";\n\nconst headerColor = Colors.brightWhite.bold;\nconst highlightColor = Colors.brightWhite;\nconst errorMessageColor = Colors.brightRed;\nconst timeoutMessageColor = Colors.purple;\nconst expectedColor = Colors.green;\nconst actualColor = Colors.brightRed;\nconst diffColor = Colors.brightYellow.bold;\nconst summaryColor = Colors.brightWhite.dim;\n\nexport class TestRenderer {\n\n\tstatic create() {\n\t\treturn new TestRenderer();\n\t}\n\n\t/**\n\t * Converts an error into a detailed description of a test failure. Intended to be used with {@link TestOptions}\n\t * rather than called directly.\n\t * @param {string[]} name The names of the test\n\t * @param {unknown} error The error that occurred\n\t * @param {TestMarkValue} mark Whether the test was marked '.skip', '.only', etc.\n\t * @param {string} [filename] The file that contained the test, if known\n\t * @return The description\n\t */\n\tstatic renderError(name: string[], error: unknown, mark: TestMarkValue, filename?: string) {\n\t\tensure.signature(arguments, [ Array, ensure.ANY_TYPE, String, [ undefined, String ] ]);\n\n\t\tconst nameFoo = normalizeName(name).pop();\n\t\tconst resultError = error as { stack: unknown, message: unknown };\n\n\t\tlet errorFoo;\n\t\tif (resultError?.stack !== undefined) {\n\t\t\terrorFoo = `${TestRenderer.renderStack(error, filename)}`;\n\t\t\tif (resultError?.message !== undefined) {\n\t\t\t\terrorFoo +=\n\t\t\t\t\t\"\\n\\n\" +\n\t\t\t\t\thighlightColor(`${nameFoo} »\\n`) +\n\t\t\t\t\terrorMessageColor(`${resultError.message}`);\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\terrorFoo = errorMessageColor(`${error}`);\n\t\t}\n\n\t\tconst diff = (error instanceof AssertionError) ?\n\t\t\t\"\\n\\n\" + TestRenderer.renderDiff(error) :\n\t\t\t\"\";\n\n\t\treturn `${errorFoo}${diff}`;\n\t}\n\n\t/**\n\t * Provides an error's stack trace, or \"\" if there wasn't one. If `filename` is provided, the stack frames that\n\t * correspond to the filename will be highlighted.\n\t * @param {unknown} error The error\n\t * @param {string} [filename] The filename to highlight\n\t * @returns {string} The stack trace for the test, or \"\" if there wasn't one.\n\t */\n\tstatic renderStack(error: unknown, filename?: string): string {\n\t\tensure.signature(arguments, [ ensure.ANY_TYPE, [ undefined, String ] ]);\n\n\t\tconst typedError = error as undefined | { stack: unknown };\n\t\tif (typedError?.stack === undefined) return \"\";\n\n\t\tconst stack = typedError.stack;\n\t\tif (typeof stack !== \"string\") return String(stack);\n\n\t\tif (filename === undefined) return stack;\n\n\t\tconst lines = stack.split(\"\\n\");\n\t\tconst highlightedLines = lines.map(line => {\n\t\t\tif (!line.includes(filename)) return line;\n\n\t\t\tline = line.replace(/    at/, \"--> at\");\t// this code is vulnerable to changes in Node.js rendering\n\t\t\treturn headerColor(line);\n\t\t});\n\t\treturn highlightedLines.join(\"\\n\");\n\t}\n\n\t/**\n\t *\n\t * @returns {string} A comparison of expected and actual values, or \"\" if there weren't any.\n\t */\n\tstatic renderDiff(error: AssertionError): string {\n\t\tensure.signature(arguments, [ AssertionError ]);\n\n\t\tif (error.expected === undefined && error.actual === undefined) return \"\";\n\t\tif (error.expected === null && error.actual === null) return \"\";\n\n\t\tconst expected = util.inspect(error.expected, { depth: Infinity }).split(\"\\n\");\n\t\tconst actual = util.inspect(error.actual, { depth: Infinity }).split(\"\\n\");\n\t\tif (expected.length > 1 || actual.length > 1) {\n\t\t\tfor (let i = 0; i < Math.max(expected.length, actual.length); i++) {\n\t\t\t\tconst expectedLine = expected[i];\n\t\t\t\tconst actualLine = actual[i];\n\n\t\t\t\tif (expectedLine !== actualLine) {\n\t\t\t\t\tif (expected[i] !== undefined) expected[i] = diffColor(expected[i]!);\n\t\t\t\t\tif (actual[i] !== undefined) actual[i] = diffColor(actual[i]!);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn \"\" +\n\t\t\texpectedColor(\"expected: \") + expected.join(\"\\n\") + \"\\n\" +\n\t\t\tactualColor(\"actual:   \") + actual.join(\"\\n\");\n\t}\n\n\t// can't use a normal constant due to a circular dependency between TestResult and TestRenderer\n\tstatic get #PROGRESS_RENDERING() {\n\t\treturn {\n\t\t\t[TestStatus.pass]: \".\",\n\t\t\t[TestStatus.fail]: Colors.brightRed.inverse(\"X\"),\n\t\t\t[TestStatus.skip]: Colors.cyan.dim(\"_\"),\n\t\t\t[TestStatus.timeout]: Colors.purple.inverse(\"!\"),\n\t\t};\n\t}\n\n\t// can't use a normal constant due to a circular dependency between TestResult and TestRenderer\n\tstatic get #DESCRIPTION_RENDERING() {\n\t\treturn {\n\t\t\t[TestStatus.pass]: Colors.green(\"passed\"),\n\t\t\t[TestStatus.fail]: Colors.brightRed(\"failed\"),\n\t\t\t[TestStatus.skip]: Colors.brightCyan(\"skipped\"),\n\t\t\t[TestStatus.timeout]: Colors.brightPurple(\"timeout\"),\n\t\t};\n\t}\n\n\t/**\n\t * @param {TestSuiteResult} testSuiteResult The test suite to render.\n\t * @param {number} [elapsedMs] The total time required to run the test suite, in milliseconds.\n\t * @returns {string} A summary of the results of a test suite, including the average time required per test if\n\t *   `elapsedMs` is defined.\n\t */\n\trenderSummary(testSuiteResult: TestSuiteResult, elapsedMs?: number): string {\n\t\tensure.signature(arguments, [ TestSuiteResult, [ undefined, Number ]]);\n\n\t\tconst { total, pass, fail, timeout, skip } = testSuiteResult.count();\n\n\t\tconst renders = [\n\t\t\trenderCount(fail, \"failed\", Colors.brightRed),\n\t\t\trenderCount(timeout, \"timed out\", Colors.purple),\n\t\t\trenderCount(skip, \"skipped\", Colors.cyan),\n\t\t\trenderCount(pass, \"passed\", Colors.green),\n\t\t\trenderMsEach(elapsedMs, total, skip),\n\t\t].filter(render => render !== \"\");\n\n\t\treturn summaryColor(\"(\") + renders.join(summaryColor(\"; \")) + summaryColor(\")\");\n\n\t\tfunction renderCount(number: number, description: string, color: ColorFn): string {\n\t\t\tif (number === 0) {\n\t\t\t\treturn \"\";\n\t\t\t}\n\t\t\telse {\n\t\t\t\treturn color(`${number} ${description}`);\n\t\t\t}\n\t\t}\n\n\t\tfunction renderMsEach(elapsedMs: number | undefined, total: number, skip: number): string {\n\t\t\tif (total - skip === 0) return summaryColor(\"none ran\");\n\t\t\tif (elapsedMs === undefined) return \"\";\n\n\t\t\tconst msEach = (elapsedMs / (total - skip)).toFixed(1);\n\t\t\treturn summaryColor(`${msEach}ms avg.`);\n\t\t}\n\t}\n\n\t/**\n\t * @returns {string} A single character for each test: a dot for passed, a red X for failed, etc.\n\t */\n\trenderAsCharacters(testCaseResults: TestCaseResult | TestCaseResult[]): string {\n\t\tensure.signature(arguments, [[ TestCaseResult, Array ]]);\n\n\t\treturn this.#renderMultipleResults(testCaseResults, \"\", TestCaseResult, (testResult: TestCaseResult) => {\n\t\t\treturn (TestRenderer.#PROGRESS_RENDERING)[testResult.status];\n\t\t});\n\t}\n\n\t/**\n\t * @returns {string} A line for each test with the status (passed, failed, etc.) and the test name.\n\t */\n\trenderAsSingleLines(testCaseResults: TestCaseResult | TestCaseResult[]): string {\n\t\tensure.signature(arguments, [[ TestCaseResult, Array ]]);\n\n\t\treturn this.#renderMultipleResults(testCaseResults, \"\\n\", TestCaseResult, (testResult: TestCaseResult) => {\n\t\t\tconst status = this.renderStatusAsSingleWord(testResult);\n\t\t\tconst name = this.renderNameOnOneLine(testResult);\n\n\t\t\treturn `${status} ${name}`;\n\t\t});\n\t}\n\n\t/**\n\t * @returns {string} A full explanation of this test result.\n\t */\n\trenderAsMultipleLines(testCaseResults: TestCaseResult | TestCaseResult[]): string {\n\t\tensure.signature(arguments, [[ TestSuiteResult, TestCaseResult, Array ]]);\n\n\t\treturn this.#renderMultipleResults(testCaseResults, \"\\n\\n\\n\", TestCaseResult, (testResult: TestCaseResult) => {\n\t\t\tconst name = this.renderNameOnMultipleLines(testResult);\n\t\t\tconst status = this.renderStatusWithMultiLineDetails(testResult);\n\n\t\t\treturn `${name}\\n\\n${status}`;\n\t\t});\n\t}\n\n\t/**\n\t * @returns {string} A line for each test that's marked (.only, .skip, etc.) with the mark and the test name.\n\t */\n\trenderMarksAsLines(testResults: TestResult | TestResult[]): string {\n\t\tensure.signature(arguments, [[ TestSuiteResult, TestCaseResult, Array ]]);\n\n\t\treturn this.#renderMultipleResults(testResults, \"\\n\", TestResult, (testResult: TestResult) => {\n\t\t\tconst mark = this.renderMarkAsSingleWord(testResult);\n\t\t\tconst name = this.renderNameOnOneLine(testResult);\n\n\t\t\tif (mark === \"\") return \"\";\n\t\t\telse return `${mark} ${name}`;\n\t\t});\n\n\t}\n\n\t/**\n\t * @returns {string} The name of the test, including parent suites and filename, rendered as a single line.\n\t */\n\trenderNameOnOneLine(testCaseResult: TestResult) {\n\t\tensure.signature(arguments, [ TestResult ]);\n\n\t\tconst filename = testCaseResult.filename === undefined\n\t\t\t? \"\"\n\t\t\t: headerColor(path.basename(testCaseResult.filename)) + \" » \";\n\t\tconst name = normalizeNameOld(testCaseResult).join(\" » \");\n\n\t\treturn `${filename}${name}`;\n\t}\n\n\t/**\n\t * @returns {string} The name of the test, including parent suites and filename, with the suites and filename\n\t *   rendered on a separate line.\n\t */\n\trenderNameOnMultipleLines(testResult: TestResult): string {\n\t\tensure.signature(arguments, [ TestResult ]);\n\n\t\tconst name = normalizeNameOld(testResult);\n\n\t\tconst suites = name.slice(0, name.length - 1);\n\t\tconst test = name[name.length - 1];\n\t\tif (testResult.filename !== undefined) suites.unshift(path.basename(testResult.filename));\n\n\t\tconst suitesName = suites.length > 0 ? suites.join(\" » \") + \"\\n» \" : \"\";\n\t\treturn headerColor(suitesName + test);\n\t}\n\n\t/**\n\t * @returns {string} The color-coded status of the test.\n\t */\n\trenderStatusAsSingleWord(testCaseResult: TestCaseResult) {\n\t\treturn TestRenderer.#DESCRIPTION_RENDERING[testCaseResult.status];\n\t}\n\n\trenderStatusWithMultiLineDetails(testCaseResult: TestCaseResult): string {\n\t\tswitch (testCaseResult.status) {\n\t\t\tcase TestStatus.pass:\n\t\t\tcase TestStatus.skip:\n\t\t\t\treturn TestRenderer.#DESCRIPTION_RENDERING[testCaseResult.status];\n\t\t\tcase TestStatus.fail:\n\t\t\t\treturn (typeof testCaseResult.errorRender === \"string\") ?\n\t\t\t\t\ttestCaseResult.errorRender :\n\t\t\t\t\tutil.inspect(testCaseResult.errorRender, { depth: Infinity });\n\t\t\tcase TestStatus.timeout:\n\t\t\t\treturn timeoutMessageColor(`Timed out after ${testCaseResult.timeout}ms`);\n\t\t\tdefault:\n\t\t\t\tthrow new Error(`Unrecognized test result status: ${testCaseResult.status}`);\n\t\t}\n\t}\n\n\t/**\n\t * @returns {string} The color-coded mark of the test result (.only, etc.), or \"\" if the test result wasn't marked.\n\t */\n\trenderMarkAsSingleWord(testResult: TestResult) {\n\t\tswitch (testResult.mark) {\n\t\t\tcase TestMark.none: return \"(no mark)\";\n\t\t\tcase TestMark.skip: return Colors.brightCyan(\".skip\");\n\t\t\tcase TestMark.only: return Colors.brightCyan(\".only\");\n\t\t\tdefault: ensure.unreachable(`Unrecognized test mark: ${testResult.mark}`);\n\t\t}\n\t}\n\n\t#renderMultipleResults<T>(\n\t\ttestResults: T | T[],\n\t\tseparator: string,\n\t\texpectedType: Function,   // eslint-disable-line @typescript-eslint/no-unsafe-function-type\n\t\trenderFn: (testResult: T) => string,\n\t): string {\n\t\tif (!Array.isArray(testResults)) testResults = [ testResults ];\n\t\ttestResults.forEach((result, i) => ensure.type(result, expectedType, `testResult[${i}]`));\n\n\t\treturn testResults.map(result => renderFn(result)).join(separator);\n\t}\n\n}\n\nfunction normalizeNameOld(testResult: TestResult) {\n\treturn testResult.name.length === 0 ? [ \"(no name)\" ] : [ ...testResult.name ];\n}\n\nfunction normalizeName(name: string[]) {\n\treturn name.length === 0 ? [ \"(no name)\" ] : [ ...name ];\n}\n"],"names":["ensure","TestCaseResult","TestMark","TestResult","TestStatus","TestSuiteResult","Colors","path","AssertionError","util","headerColor","brightWhite","bold","highlightColor","errorMessageColor","brightRed","timeoutMessageColor","purple","expectedColor","green","actualColor","diffColor","brightYellow","summaryColor","dim","TestRenderer","create","renderError","name","error","mark","filename","signature","arguments","Array","ANY_TYPE","String","undefined","nameFoo","normalizeName","pop","resultError","errorFoo","stack","renderStack","message","diff","renderDiff","typedError","lines","split","highlightedLines","map","line","includes","replace","join","expected","actual","inspect","depth","Infinity","length","i","Math","max","expectedLine","actualLine","pass","fail","inverse","skip","cyan","timeout","brightCyan","brightPurple","renderSummary","testSuiteResult","elapsedMs","Number","total","count","renders","renderCount","renderMsEach","filter","render","number","description","color","msEach","toFixed","renderAsCharacters","testCaseResults","testResult","status","renderAsSingleLines","renderStatusAsSingleWord","renderNameOnOneLine","renderAsMultipleLines","renderNameOnMultipleLines","renderStatusWithMultiLineDetails","renderMarksAsLines","testResults","renderMarkAsSingleWord","testCaseResult","basename","normalizeNameOld","suites","slice","test","unshift","suitesName","errorRender","Error","none","only","unreachable","separator","expectedType","renderFn","isArray","forEach","result","type"],"mappings":"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"}