{"version":3,"sources":["/Users/jshore/Documents/Projects/ergotest/src/tests/test_renderer.ts"],"sourcesContent":["// Copyright Titanium I.T. LLC. License granted under terms of \"The MIT License.\"\n\nimport * as ensure from \"../util/ensure.js\";\nimport { TestCaseResult, TestResult, TestStatus, TestSuiteResult } from \"./test_result.js\";\nimport { TestMark } from \"./test_suite.js\";\nimport { ColorFn, Colors } from \"../infrastructure/colors.js\";\nimport path from \"node:path\";\nimport { AssertionError } from \"node:assert\";\nimport util from \"node:util\";\n\nconst headerColor = Colors.brightWhite.bold;\nconst highlightColor = Colors.brightWhite;\nconst errorMessageColor = Colors.brightRed;\nconst timeoutMessageColor = Colors.purple;\nconst expectedColor = Colors.green;\nconst actualColor = Colors.brightRed;\nconst diffColor = Colors.brightYellow.bold;\nconst summaryColor = Colors.brightWhite.dim;\n\nexport class TestRenderer {\n\n\tstatic create() {\n\t\treturn new TestRenderer();\n\t}\n\n\t// can't use a normal constant due to a circular dependency between TestResult and TestRenderer\n\tstatic get #PROGRESS_RENDERING() {\n\t\treturn {\n\t\t\t[TestStatus.pass]: \".\",\n\t\t\t[TestStatus.fail]: Colors.brightRed.inverse(\"X\"),\n\t\t\t[TestStatus.skip]: Colors.cyan.dim(\"_\"),\n\t\t\t[TestStatus.timeout]: Colors.purple.inverse(\"!\"),\n\t\t};\n\t}\n\n\t// can't use a normal constant due to a circular dependency between TestResult and TestRenderer\n\tstatic get #DESCRIPTION_RENDERING() {\n\t\treturn {\n\t\t\t[TestStatus.pass]: Colors.green(\"passed\"),\n\t\t\t[TestStatus.fail]: Colors.brightRed(\"failed\"),\n\t\t\t[TestStatus.skip]: Colors.brightCyan(\"skipped\"),\n\t\t\t[TestStatus.timeout]: Colors.brightPurple(\"timeout\"),\n\t\t};\n\t}\n\n\t/**\n\t * @param {TestSuiteResult} testSuiteResult The test suite to render.\n\t * @param {number} elapsedMs The total time required to run the test suite, in milliseconds.\n\t * @returns {string} A summary of the results of a test suite, including the average time required per test.\n\t */\n\trenderSummary(testSuiteResult: TestSuiteResult, elapsedMs: number): string {\n\t\tensure.signature(arguments, [ TestSuiteResult, Number ]);\n\n\t\tconst { total, pass, fail, timeout, skip } = testSuiteResult.count();\n\n\t\treturn summaryColor(\"(\") +\n\t\t\trenderCount(fail, \"failed\", Colors.brightRed) +\n\t\t\trenderCount(timeout, \"timed out\", Colors.purple) +\n\t\t\trenderCount(skip, \"skipped\", Colors.cyan) +\n\t\t\trenderCount(pass, \"passed\", Colors.green) +\n\t\t\trenderMsEach(elapsedMs, total, skip) +\n\t\t\tsummaryColor(\")\");\n\n\t\tfunction renderCount(number: number, description: string, color: ColorFn): string {\n\t\t\tif (number === 0) {\n\t\t\t\treturn \"\";\n\t\t\t}\n\t\t\telse {\n\t\t\t\treturn color(`${number} ${description}; `);\n\t\t\t}\n\t\t}\n\n\t\tfunction renderMsEach(elapsedMs: number, total: number, skip: number): string {\n\t\t\tif (total - skip === 0) return summaryColor(\"none ran\");\n\n\t\t\tconst msEach = (elapsedMs / (total - skip)).toFixed(1);\n\t\t\treturn summaryColor(`${msEach}ms avg.`);\n\t\t}\n\t}\n\n\t/**\n\t * @returns {string} A single character for each test: a dot for passed, a red X for failed, etc.\n\t */\n\trenderAsCharacters(testCaseResults: TestCaseResult | TestCaseResult[]): string {\n\t\tensure.signature(arguments, [[ TestCaseResult, Array ]]);\n\n\t\treturn this.#renderMultipleResults(testCaseResults, \"\", TestCaseResult, (testResult: TestCaseResult) => {\n\t\t\treturn (TestRenderer.#PROGRESS_RENDERING)[testResult.status];\n\t\t});\n\t}\n\n\t/**\n\t * @returns {string} A line for each test with the status (passed, failed, etc.) and the test name.\n\t */\n\trenderAsSingleLines(testCaseResults: TestCaseResult | TestCaseResult[]): string {\n\t\tensure.signature(arguments, [[ TestCaseResult, Array ]]);\n\n\t\treturn this.#renderMultipleResults(testCaseResults, \"\\n\", TestCaseResult, (testResult: TestCaseResult) => {\n\t\t\tconst status = this.renderStatusAsSingleWord(testResult);\n\t\t\tconst name = this.renderNameOnOneLine(testResult);\n\n\t\t\treturn `${status} ${name}`;\n\t\t});\n\t}\n\n\t/**\n\t * @returns {string} A full explanation of this test result.\n\t */\n\trenderAsMultipleLines(testCaseResults: TestCaseResult | TestCaseResult[]): string {\n\t\tensure.signature(arguments, [[ TestSuiteResult, TestCaseResult, Array ]]);\n\n\t\treturn this.#renderMultipleResults(testCaseResults, \"\\n\\n\\n\", TestCaseResult, (testResult: TestCaseResult) => {\n\t\t\tconst name = this.renderNameOnMultipleLines(testResult);\n\t\t\tconst status = this.renderStatusWithMultiLineDetails(testResult);\n\n\t\t\treturn `${name}\\n${status}`;\n\t\t});\n\t}\n\n\t/**\n\t * @returns {string} A line for each test that's marked (.only, .skip, etc.) with the mark and the test name.\n\t */\n\trenderMarksAsLines(testResults: TestResult | TestResult[]): string {\n\t\tensure.signature(arguments, [[ TestSuiteResult, TestCaseResult, Array ]]);\n\n\t\treturn this.#renderMultipleResults(testResults, \"\\n\", TestResult, (testResult: TestResult) => {\n\t\t\tconst mark = this.renderMarkAsSingleWord(testResult);\n\t\t\tconst name = this.renderNameOnOneLine(testResult);\n\n\t\t\tif (mark === \"\") return \"\";\n\t\t\telse return `${mark} ${name}`;\n\t\t});\n\n\t}\n\n\t/**\n\t * @returns {string} The name of the test, including parent suites and filename, rendered as a single line.\n\t */\n\trenderNameOnOneLine(testCaseResult: TestResult) {\n\t\tensure.signature(arguments, [ TestResult ]);\n\n\t\tconst filename = testCaseResult.filename === undefined\n\t\t\t? \"\"\n\t\t\t: headerColor(path.basename(testCaseResult.filename)) + \" » \";\n\t\tconst name = this.#normalizedName(testCaseResult).join(\" » \");\n\n\t\treturn `${filename}${name}`;\n\t}\n\n\t/**\n\t * @returns {string} The name of the test, including parent suites and filename, with the suites and filename\n\t *   rendered on a separate line.\n\t */\n\trenderNameOnMultipleLines(testResult: TestResult): string {\n\t\tensure.signature(arguments, [ TestResult ]);\n\n\t\tconst name = this.#normalizedName(testResult);\n\n\t\tconst suites = name.slice(0, name.length - 1);\n\t\tconst test = name[name.length - 1];\n\t\tif (testResult.filename !== undefined) suites.unshift(path.basename(testResult.filename));\n\n\t\tconst suitesName = suites.length > 0 ? suites.join(\" » \") + \"\\n» \" : \"\";\n\t\treturn headerColor(suitesName + test);\n\t}\n\n\t#normalizedName(testResult: TestResult) {\n\t\treturn testResult.name.length === 0 ? [ \"(no name)\" ] : [ ...testResult.name ];\n\t}\n\n\t/**\n\t * @returns {string} The color-coded status of the test.\n\t */\n\trenderStatusAsSingleWord(testCaseResult: TestCaseResult) {\n\t\treturn TestRenderer.#DESCRIPTION_RENDERING[testCaseResult.status];\n\t}\n\n\trenderStatusWithMultiLineDetails(testCaseResult: TestCaseResult): string {\n\t\tswitch (testCaseResult.status) {\n\t\t\tcase TestStatus.pass:\n\t\t\tcase TestStatus.skip:\n\t\t\t\treturn TestRenderer.#DESCRIPTION_RENDERING[testCaseResult.status];\n\t\t\tcase TestStatus.fail:\n\t\t\t\treturn this.#renderFailure(testCaseResult);\n\t\t\tcase TestStatus.timeout:\n\t\t\t\treturn timeoutMessageColor(`Timed out after ${testCaseResult.timeout}ms`);\n\t\t\tdefault:\n\t\t\t\tthrow new Error(`Unrecognized test result status: ${testCaseResult.status}`);\n\t\t}\n\t}\n\n\t/**\n\t * @returns {string} The color-coded mark of the test result (.only, etc.), or \"\" if the test result wasn't marked.\n\t */\n\trenderMarkAsSingleWord(testResult: TestResult) {\n\t\tswitch (testResult.mark) {\n\t\t\tcase TestMark.none: return \"(no mark)\";\n\t\t\tcase TestMark.skip: return Colors.brightCyan(\".skip\");\n\t\t\tcase TestMark.only: return Colors.brightCyan(\".only\");\n\t\t\tdefault: ensure.unreachable(`Unrecognized test mark: ${testResult.mark}`);\n\t\t}\n\t}\n\n\t#renderFailure(testCaseResult: TestCaseResult): string {\n\t\tconst name = this.#normalizedName(testCaseResult).pop();\n\t\tconst resultError = testCaseResult.error as { stack: unknown, message: unknown };\n\n\t\tlet error;\n\t\tif (resultError?.stack !== undefined) {\n\t\t\terror = `${this.renderStack(testCaseResult)}`;\n\t\t\tif (resultError?.message !== undefined) {\n\t\t\t\terror +=\n\t\t\t\t\t\"\\n\\n\" +\n\t\t\t\t\thighlightColor(`${name} »\\n`) +\n\t\t\t\t\terrorMessageColor(`${resultError.message}`);\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\terror = errorMessageColor(`${testCaseResult.error}`);\n\t\t}\n\n\t\tconst diff = (testCaseResult.error instanceof AssertionError) ?\n\t\t\t\"\\n\\n\" + this.renderDiff(testCaseResult.error) :\n\t\t\t\"\";\n\n\t\treturn `${error}${diff}`;\n\t}\n\n\t/**\n\t * @returns {string} The stack trace for the test, or \"\" if there wasn't one.\n\t */\n\trenderStack(testCaseResult: TestCaseResult): string {\n\t\tconst testCaseError = testCaseResult.error as undefined | { stack: unknown };\n\t\tif (testCaseError?.stack === undefined) return \"\";\n\n\t\tconst stack = testCaseError.stack;\n\t\tif (typeof stack !== \"string\") return `${stack}`;\n\n\t\tconst filename = testCaseResult.filename;\n\t\tif (filename === undefined) return stack;\n\n\t\tconst lines = stack.split(\"\\n\");\n\t\tconst highlightedLines = lines.map(line => {\n\t\t\tif (!line.includes(filename)) return line;\n\n\t\t\tline = line.replace(/    at/, \"--> at\");\t// this code is vulnerable to changes in Node.js rendering\n\t\t\treturn headerColor(line);\n\t\t});\n\t\treturn highlightedLines.join(\"\\n\");\n\t}\n\n\t/**\n\t * @returns {string} A comparison of expected and actual values, or \"\" if there weren't any.\n\t */\n\trenderDiff(error: AssertionError): string {\n\t\tif (error.expected === undefined && error.actual === undefined) return \"\";\n\t\tif (error.expected === null && error.actual === null) return \"\";\n\n\t\tconst expected = util.inspect(error.expected, { depth: Infinity }).split(\"\\n\");\n\t\tconst actual = util.inspect(error.actual, { depth: Infinity }).split(\"\\n\");\n\t\tif (expected.length > 1 || actual.length > 1) {\n\t\t\tfor (let i = 0; i < Math.max(expected.length, actual.length); i++) {\n\t\t\t\tconst expectedLine = expected[i];\n\t\t\t\tconst actualLine = actual[i];\n\n\t\t\t\tif (expectedLine !== actualLine) {\n\t\t\t\t\tif (expected[i] !== undefined) expected[i] = diffColor(expected[i]!);\n\t\t\t\t\tif (actual[i] !== undefined) actual[i] = diffColor(actual[i]!);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn \"\" +\n\t\t\texpectedColor(\"expected: \") + expected.join(\"\\n\") + \"\\n\" +\n\t\t\tactualColor(\"actual:   \") + actual.join(\"\\n\");\n\t}\n\n\t#renderMultipleResults<T>(\n\t\ttestResults: T | T[],\n\t\tseparator: string,\n\t\texpectedType: Function,   // eslint-disable-line @typescript-eslint/no-unsafe-function-type\n\t\trenderFn: (testResult: T) => string,\n\t): string {\n\t\tif (!Array.isArray(testResults)) testResults = [ testResults ];\n\t\ttestResults.forEach((result, i) => ensure.type(result, expectedType, `testResult[${i}]`));\n\n\t\treturn testResults.map(result => renderFn(result)).join(separator);\n\t}\n\n}"],"names":["ensure","TestCaseResult","TestResult","TestStatus","TestSuiteResult","TestMark","Colors","path","AssertionError","util","headerColor","brightWhite","bold","highlightColor","errorMessageColor","brightRed","timeoutMessageColor","purple","expectedColor","green","actualColor","diffColor","brightYellow","summaryColor","dim","TestRenderer","create","pass","fail","inverse","skip","cyan","timeout","brightCyan","brightPurple","renderSummary","testSuiteResult","elapsedMs","signature","arguments","Number","total","count","renderCount","renderMsEach","number","description","color","msEach","toFixed","renderAsCharacters","testCaseResults","Array","testResult","status","renderAsSingleLines","renderStatusAsSingleWord","name","renderNameOnOneLine","renderAsMultipleLines","renderNameOnMultipleLines","renderStatusWithMultiLineDetails","renderMarksAsLines","testResults","mark","renderMarkAsSingleWord","testCaseResult","filename","undefined","basename","join","suites","slice","length","test","unshift","suitesName","Error","none","only","unreachable","pop","resultError","error","stack","renderStack","message","diff","renderDiff","testCaseError","lines","split","highlightedLines","map","line","includes","replace","expected","actual","inspect","depth","Infinity","i","Math","max","expectedLine","actualLine","separator","expectedType","renderFn","isArray","forEach","result","type"],"mappings":"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"}