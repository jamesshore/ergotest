{"version":3,"sources":["/Users/jshore/Documents/Projects/ergotest/src/infrastructure/_clock_test.ts"],"sourcesContent":["// Copyright Titanium I.T. LLC. License granted under terms of \"The MIT License.\"\nimport { assert, describe, it } from \"../tests.js\";\nimport { Clock } from \"./clock.js\";\n\nexport default describe(() => {\n\n\tdescribe(\"information\", () => {\n\n\t\tit(\"provides current timestamp\", () => {\n\t\t\tconst clock = Clock.create();\n\n\t\t\tlet expected = Date.now();\n\t\t\tconst actual = clock.now();\n\t\t\tif (actual !== expected) expected = Date.now();\n\t\t\tassert.equal(actual, expected);\n\t\t});\n\n\t\tit(\"tells us how many milliseconds have elapsed since a time\", async () => {\n\t\t\tconst nullClock = await Clock.createNullAsync({ now: 50 });\n\t\t\tawait nullClock.tickAsync(999);\n\n\t\t\tassert.equal(nullClock.millisecondsSince(50), 999, \"should compare to number\");\n\t\t\tassert.equal(nullClock.millisecondsSince(new Date(50)), 999, \"should compare to Date\");\n\t\t});\n\n\t\tit(\"tells us how many milliseconds until a time\", async () => {\n\t\t\tconst nullClock = await Clock.createNullAsync({ now: 100 });\n\t\t\tassert.equal(nullClock.millisecondsUntil(500), 400, \"should compare to number\");\n\t\t\tassert.equal(nullClock.millisecondsUntil(new Date(500)), 400, \"should compare to Date\");\n\t\t});\n\n\t});\n\n\n\tdescribe(\"wait\", () => {\n\n\t\tit(\"waits N milliseconds\", async () => {\n\t\t\tconst clock = Clock.create();\n\n\t\t\tconst start = clock.now();\n\t\t\tawait clock.waitAsync(10);\n\t\t\tconst elapsedTime = clock.now() - start;\n\t\t\tassert.atLeast(elapsedTime, 9);\n\t\t});\n\n\t});\n\n\n\tdescribe(\"repeat\", () => {\n\n\t\tit(\"calls a function every N milliseconds\", async () => {\n\t\t\tconst clock = await Clock.createNullAsync();\t\t// real clock is too nondeterministic to test directly\n\n\t\t\tlet runCount = 0;\n\t\t\tconst stopFn = clock.repeat(5, () => runCount++);\n\n\t\t\tawait clock.tickAsync(15);\n\t\t\tassert.equal(runCount, 3, \"should call repeat function on regular interval\");\n\n\t\t\tstopFn();\n\t\t\tawait clock.tickAsync(1000);\n\t\t\tassert.equal(runCount, 3, \"should not call repeat function after stop function called\");\n\t\t});\n\n\t});\n\n\n\tdescribe(\"keepalive\", () => {\n\n\t\tit(\"runs a function after N milliseconds\", async () => {\n\t\t\tconst clock = await Clock.createNullAsync();\n\n\t\t\tlet expireTime;\n\t\t\tclock.keepAlive(10, () => { expireTime = clock.now(); });\n\n\t\t\tawait clock.tickAsync(9);\n\t\t\tassert.isUndefined(expireTime, \"should not have expired\");\n\n\t\t\tawait clock.tickUntilTimersExpireAsync();\n\t\t\tassert.equal(expireTime, 10, \"should have expired\");\n\t\t});\n\n\t\tit(\"resets the countdown when the 'alive' function is called\", async () => {\n\t\t\tconst clock = await Clock.createNullAsync();\n\n\t\t\tlet expireTime;\n\t\t\tconst { aliveFn } = clock.keepAlive(10, () => { expireTime = clock.now(); });\n\n\t\t\tawait clock.tickAsync(9);\n\t\t\taliveFn();\n\n\t\t\tawait clock.tickAsync(9);\n\t\t\tassert.isUndefined(expireTime, \"should not have expired\");\n\n\t\t\tawait clock.tickUntilTimersExpireAsync();\n\t\t\tassert.equal(expireTime, 19, \"should have expired\");\n\t\t});\n\n\t\tit(\"stops the countdown when the 'cancel' function is called\", async () => {\n\t\t\tconst clock = await Clock.createNullAsync();\n\n\t\t\tlet expireTime;\n\t\t\tconst { cancelFn } = clock.keepAlive(10, () => { expireTime = clock.now(); });\n\n\t\t\tcancelFn();\n\t\t\tawait clock.tickAsync(100);\n\t\t\tawait clock.tickUntilTimersExpireAsync();\n\n\t\t\tassert.isUndefined(expireTime, \"should not have expired\");\n\t\t});\n\n\t\tit(\"'alive' function doesn't restart the countdown after 'cancel' called\", async () => {\n\t\t\tconst clock = await Clock.createNullAsync();\n\n\t\t\tlet expireTime;\n\t\t\tconst { aliveFn, cancelFn } = clock.keepAlive(10, () => { expireTime = clock.now(); });\n\n\t\t\tcancelFn();\n\t\t\taliveFn();\n\t\t\tawait clock.tickAsync(100);\n\t\t\tawait clock.tickUntilTimersExpireAsync();\n\n\t\t\tassert.isUndefined(expireTime, \"should not have expired\");\n\t\t});\n\n\t});\n\n\n\tdescribe(\"timeouts\", () => {\n\n\t\tfunction createTimeoutFn(result: string | Error = \"default timeout function result\") {\n\t\t\tconst timeoutFn = () => {\n\t\t\t\ttimeoutFn.ran = true;\n\t\t\t\tif (result instanceof Error) return Promise.reject(result);\n\t\t\t\telse return Promise.resolve(result);\n\t\t\t};\n\n\t\t\ttimeoutFn.ran = false;\n\t\t\treturn timeoutFn;\n\t\t}\n\n\t\tit(\"resolves if promise resolves before timeout\", async () => {\n\t\t\tconst clock = await Clock.createNullAsync();\n\t\t\tconst timeoutFnAsync = createTimeoutFn();\n\t\t\tconst promise = Promise.resolve(\"result\");\n\n\t\t\tconst result = await clock.timeoutAsync(10000, () => promise, timeoutFnAsync);\n\t\t\tassert.equal(await result, \"result\", \"should return result of promise\");\n\t\t\tassert.equal(timeoutFnAsync.ran, false, \"should not run timeout function\");\n\n\t\t\tawait clock.tickUntilTimersExpireAsync();\n\t\t\tassert.equal(clock.now(), 0, \"should resolve immediately\");\n\t\t});\n\n\t\tit(\"rejects if promise rejects before timeout\", async () => {\n\t\t\tconst clock = await Clock.createNullAsync();\n\t\t\tconst timeoutFnAsync = createTimeoutFn();\n\t\t\tconst promise = Promise.reject(new Error(\"my error\"));\n\n\t\t\tawait assert.errorAsync(\n\t\t\t\t() => clock.timeoutAsync(10000, () => promise, timeoutFnAsync),\n\t\t\t\t\"my error\",\n\t\t\t\t\"should return result of promise\"\n\t\t\t);\n\t\t\tassert.equal(timeoutFnAsync.ran, false, \"should not run timeout function\");\n\n\t\t\tawait clock.tickUntilTimersExpireAsync();\n\t\t\tassert.equal(clock.now(), 0, \"should resolve immediately\");\n\t\t});\n\n\t\tit(\"resolves via timeout function if promise times out\", async () => {\n\t\t\tconst clock = await Clock.createNullAsync();\n\t\t\tconst timeoutFnAsync = createTimeoutFn(\"timeout result\");\n\n\t\t\tconst promise = new Promise(() => {});\n\t\t\tconst timeoutPromise = clock.timeoutAsync(10000, () => promise, timeoutFnAsync);\n\n\t\t\tawait clock.tickUntilTimersExpireAsync();\n\t\t\tassert.equal(clock.now(), 10000, \"should wait for timeout\");\n\t\t\tassert.equal(timeoutFnAsync.ran, true, \"should run timeout function\");\n\t\t\tassert.equal(await timeoutPromise, \"timeout result\", \"should return result of timeout function\");\n\t\t});\n\n\t\tit(\"rejects via timeout function if promise times out and timeout rejects\", async () => {\n\t\t\tconst clock = await Clock.createNullAsync();\n\t\t\tconst timeoutFnAsync = createTimeoutFn(new Error(\"my error\"));\n\n\t\t\tconst promise = new Promise(() => {});\n\t\t\tconst timeoutPromise = clock.timeoutAsync(10000, () => promise, timeoutFnAsync);\n\t\t\ttimeoutPromise.catch(() => {});   // prevent 'unhandled promise exception'\n\n\t\t\tawait clock.tickUntilTimersExpireAsync();\n\t\t\tassert.equal(clock.now(), 10000, \"should wait for timeout\");\n\t\t\tassert.equal(timeoutFnAsync.ran, true, \"should run timeout function\");\n\t\t\tawait assert.errorAsync(\n\t\t\t\t() => timeoutPromise,\n\t\t\t\t\"my error\",\n\t\t\t\t\"should reject because timeout function rejected\"\n\t\t\t);\n\t\t});\n\n\t\tit(\"ignores promise rejection after timeout\", async () => {\n\t\t\tconst clock = await Clock.createNullAsync();\n\t\t\tconst timeoutFnAsync = createTimeoutFn(\"timeout result\");\n\t\t\tconst promise = (async () => {\n\t\t\t\tawait clock.waitAsync(20000);\n\t\t\t\tthrow new Error(\"this error should be ignored\");\n\t\t\t})();\n\n\t\t\tconst timeoutPromise = clock.timeoutAsync(10000, () => promise, timeoutFnAsync);\n\t\t\tawait clock.tickUntilTimersExpireAsync();\n\t\t\tassert.equal(await timeoutPromise, \"timeout result\");\n\t\t});\n\n\t});\n\n\n\tdescribe(\"nullability\", () => {\n\n\t\tit(\"defaults 'now' to zero\", async () => {\n\t\t\tconst clock = await Clock.createNullAsync();\n\t\t\tassert.equal(clock.now(), 0);\n\t\t});\n\n\t\tit(\"allows 'now' to be configured using milliseconds\", async () => {\n\t\t\tconst clock = await Clock.createNullAsync({ now: 300 });\n\t\t\tassert.equal(clock.now(), 300);\n\t\t});\n\n\t\tit(\"allows 'now' to be configured using date object\", async () => {\n\t\t\tconst clock = await Clock.createNullAsync({ now: new Date(400) });\n\t\t\tassert.equal(clock.now(), 400);\n\t\t});\n\n\t\tit(\"can advance the clock\", async () => {\n\t\t\tconst clock = await Clock.createNullAsync();\n\t\t\tawait clock.tickAsync(10);\n\t\t\tassert.equal(clock.now(), 10);\n\t\t});\n\n\t\tit(\"can advance the clock until all timers expired\", async () => {\n\t\t\tconst clock = await Clock.createNullAsync();\n\t\t\tclock.waitAsync(999);\n\t\t\tawait clock.tickUntilTimersExpireAsync();\n\t\t\tassert.equal(clock.now(), 999);\n\t\t});\n\n\t\tit(\"fails fast when attempting to advance the system clock\", async () => {\n\t\t\tconst clock = Clock.create();\n\t\t\tawait assert.errorAsync(\n\t\t\t\t() => clock.tickAsync(10),\n\t\t\t\t\"Can't advance the clock because it isn't a null clock\"\n\t\t\t);\n\t\t\tawait assert.errorAsync(\n\t\t\t\t() => clock.tickUntilTimersExpireAsync(),\n\t\t\t\t\"Can't advance the clock because it isn't a null clock\"\n\t\t\t);\n\t\t});\n\n\t\tit(\"can wait\", async () => {\n\t\t\tconst clock = await Clock.createNullAsync();\n\t\t\tlet wait: string | number = \"waiting\";\n\n\t\t\tclock.waitAsync(10).then(() => {\n\t\t\t\twait = clock.now();\n\t\t\t});\n\t\t\tassert.equal(wait, \"waiting\");\n\t\t\tawait clock.tickAsync(20);\n\t\t\tassert.equal(wait, 10);\n\t\t});\n\n\t\tit(\"can repeat\", async () => {\n\t\t\tconst clock = await Clock.createNullAsync();\n\n\t\t\tlet runCount = 0;\n\t\t\tconst stopFn = clock.repeat(100, () => {\n\t\t\t\trunCount++;\n\t\t\t\tif (runCount > 50) stopFn();\n\t\t\t});\n\n\t\t\tassert.equal(runCount, 0, \"start\");\n\n\t\t\tawait clock.tickAsync(100);\n\t\t\tassert.equal(runCount, 1, \"manual tick\");\n\n\t\t\tawait clock.tickUntilTimersExpireAsync();\n\t\t\tassert.equal(runCount, 51, \"automatic tick\");\n\t\t});\n\n\t\tit(\"can timeout\", async () => {\n\t\t\tconst clock = await Clock.createNullAsync();\n\t\t\tawait clock.timeoutAsync<void>(10, () => Promise.resolve(), () => {});\n\t\t});\n\n\t});\n\n});"],"names":["assert","describe","it","Clock","clock","create","expected","Date","now","actual","equal","nullClock","createNullAsync","tickAsync","millisecondsSince","millisecondsUntil","start","waitAsync","elapsedTime","atLeast","runCount","stopFn","repeat","expireTime","keepAlive","isUndefined","tickUntilTimersExpireAsync","aliveFn","cancelFn","createTimeoutFn","result","timeoutFn","ran","Error","Promise","reject","resolve","timeoutFnAsync","promise","timeoutAsync","errorAsync","timeoutPromise","catch","wait","then"],"mappings":"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"}