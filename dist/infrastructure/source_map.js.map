{"version":3,"sources":["/Users/jshore/Documents/Projects/ergotest/src/infrastructure/source_map.ts"],"sourcesContent":["// Copyright Titanium I.T. LLC. License granted under terms of \"The MIT License.\"\nimport * as module from \"node:module\";\n\nexport interface NulledSourceMapConfiguration {\n\t[modulePath: string]: string[]\n}\n\nexport class SourceMap {\n\n\tprivate readonly _module: Module;\n\n\tstatic create() {\n\t\treturn new SourceMap(module);\n\t}\n\n\tstatic createNull(config?: NulledSourceMapConfiguration) {\n\t\treturn new SourceMap(new ModuleStub(config));\n\t}\n\n\tconstructor(module: Module) {\n\t\tthis._module = module;\n\t}\n\n\tgetOriginalFilenames(pathToPreviouslyImportedModule: string): string[] {\n\t\tconst sourceMap = this._module.findSourceMap(pathToPreviouslyImportedModule);\n\t\tif (sourceMap === undefined) return [];\n\n\t\treturn sourceMap.payload.sources.map(filename => {\n\t\t\tif(filename.substring(0, 7) !== \"file://\") return filename; // this line not tested\n\t\t\telse return filename.slice(7);\n\t\t});\n\t}\n\n}\n\ninterface Module {\n\tfindSourceMap(path: string): undefined | Payload,\n}\n\ninterface Payload {\n\tpayload: {\n\t\tsources: string[],\n\t},\n}\n\nclass ModuleStub implements Module {\n\n\tprivate readonly _config: NulledSourceMapConfiguration;\n\n\tconstructor(config: NulledSourceMapConfiguration = {}) {\n\t\tthis._config = config;\n\t}\n\n\tfindSourceMap(path: string): Payload {\n\t\tconst sources = this._config[path] ?? [];\n\n\t\treturn {\n\t\t\tpayload: {\n\t\t\t\tsources,\n\t\t\t}\n\t\t};\n\t}\n\n}\n\n"],"names":["module","SourceMap","_module","create","createNull","config","ModuleStub","constructor","getOriginalFilenames","pathToPreviouslyImportedModule","sourceMap","findSourceMap","undefined","payload","sources","map","filename","substring","slice","_config","path"],"mappings":"AAAA,iFAAiF;AACjF,YAAYA,YAAY,cAAc;AAMtC,OAAO,MAAMC;IAEKC,QAAgB;IAEjC,OAAOC,SAAS;QACf,OAAO,IAAIF,UAAUD;IACtB;IAEA,OAAOI,WAAWC,MAAqC,EAAE;QACxD,OAAO,IAAIJ,UAAU,IAAIK,WAAWD;IACrC;IAEAE,YAAYP,MAAc,CAAE;QAC3B,IAAI,CAACE,OAAO,GAAGF;IAChB;IAEAQ,qBAAqBC,8BAAsC,EAAY;QACtE,MAAMC,YAAY,IAAI,CAACR,OAAO,CAACS,aAAa,CAACF;QAC7C,IAAIC,cAAcE,WAAW,OAAO,EAAE;QAEtC,OAAOF,UAAUG,OAAO,CAACC,OAAO,CAACC,GAAG,CAACC,CAAAA;YACpC,IAAGA,SAASC,SAAS,CAAC,GAAG,OAAO,WAAW,OAAOD,UAAU,uBAAuB;iBAC9E,OAAOA,SAASE,KAAK,CAAC;QAC5B;IACD;AAED;AAYA,MAAMZ;IAEYa,QAAsC;IAEvDZ,YAAYF,SAAuC,CAAC,CAAC,CAAE;QACtD,IAAI,CAACc,OAAO,GAAGd;IAChB;IAEAM,cAAcS,IAAY,EAAW;QACpC,MAAMN,UAAU,IAAI,CAACK,OAAO,CAACC,KAAK,IAAI,EAAE;QAExC,OAAO;YACNP,SAAS;gBACRC;YACD;QACD;IACD;AAED"}