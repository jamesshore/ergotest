{"version":3,"sources":["/Users/jshore/Documents/Projects/ergotest/src/infrastructure/source_map.ts"],"sourcesContent":["// Copyright Titanium I.T. LLC. License granted under terms of \"The MIT License.\"\nimport * as module from \"node:module\";\n\nexport interface NulledSourceMapConfiguration {\n\t[modulePath: string]: string[]\n}\n\nexport class SourceMap {\n\n\tstatic create() {\n\t\treturn new SourceMap(module);\n\t}\n\n\tstatic createNull(config?: NulledSourceMapConfiguration) {\n\t\treturn new SourceMap(new ModuleStub(config));\n\t}\n\n\tconstructor(private readonly _module: Module) {\n\t}\n\n\tgetOriginalFilenames(pathToPreviouslyImportedModule: string): string[] {\n\t\tconst sourceMap = this._module.findSourceMap(pathToPreviouslyImportedModule);\n\t\tif (sourceMap === undefined) return [];\n\n\t\treturn sourceMap.payload.sources.map(filename => {\n\t\t\tif(filename.substring(0, 7) !== \"file://\") return filename; // this line not tested\n\t\t\telse return filename.slice(7);\n\t\t});\n\t}\n\n}\n\ninterface Module {\n\tfindSourceMap(path: string): undefined | Payload,\n}\n\ninterface Payload {\n\tpayload: {\n\t\tsources: string[],\n\t},\n}\n\nclass ModuleStub implements Module {\n\n\tconstructor(private readonly _config: NulledSourceMapConfiguration = {}) {\n\t}\n\n\tfindSourceMap(path: string): Payload {\n\t\tconst sources = this._config[path] ?? [];\n\n\t\treturn {\n\t\t\tpayload: {\n\t\t\t\tsources,\n\t\t\t}\n\t\t};\n\t}\n\n}\n\n"],"names":["module","SourceMap","create","createNull","config","ModuleStub","constructor","_module","getOriginalFilenames","pathToPreviouslyImportedModule","sourceMap","findSourceMap","undefined","payload","sources","map","filename","substring","slice","_config","path"],"mappings":"AAAA,iFAAiF;AACjF,YAAYA,YAAY,cAAc;AAMtC,OAAO,MAAMC;;IAEZ,OAAOC,SAAS;QACf,OAAO,IAAID,UAAUD;IACtB;IAEA,OAAOG,WAAWC,MAAqC,EAAE;QACxD,OAAO,IAAIH,UAAU,IAAII,WAAWD;IACrC;IAEAE,YAAY,AAAiBC,OAAe,CAAE;aAAjBA,UAAAA;IAC7B;IAEAC,qBAAqBC,8BAAsC,EAAY;QACtE,MAAMC,YAAY,IAAI,CAACH,OAAO,CAACI,aAAa,CAACF;QAC7C,IAAIC,cAAcE,WAAW,OAAO,EAAE;QAEtC,OAAOF,UAAUG,OAAO,CAACC,OAAO,CAACC,GAAG,CAACC,CAAAA;YACpC,IAAGA,SAASC,SAAS,CAAC,GAAG,OAAO,WAAW,OAAOD,UAAU,uBAAuB;iBAC9E,OAAOA,SAASE,KAAK,CAAC;QAC5B;IACD;AAED;AAYA,MAAMb;;IAELC,YAAY,AAAiBa,UAAwC,CAAC,CAAC,CAAE;aAA5CA,UAAAA;IAC7B;IAEAR,cAAcS,IAAY,EAAW;QACpC,MAAMN,UAAU,IAAI,CAACK,OAAO,CAACC,KAAK,IAAI,EAAE;QAExC,OAAO;YACNP,SAAS;gBACRC;YACD;QACD;IACD;AAED"}